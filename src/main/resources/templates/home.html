<!DOCTYPE html>
<html lang="en" xmlns:th="http://thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity3" xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="UTF-8">
    <title>Drop Box</title>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css"
          integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
    <style>
        #main-div {
            display: flex;
            flex-direction: row;
        }
       .upload-main{
           width:30%;
           margin:auto;
           height:30%;
           display: flex;
           flex-basis: auto;
       }
       #button-main {
           padding-left: 20px;
           padding-right: 30px;
       }
       #files-table {
        border-collapse: collapse;
        border: inset;
        width: 60%;
        margin-left: 10%;
       }
       .files-table-row {
           text-align: center;
       }
       #action-div {
          display: flex;
          flex-direction: row;
          margin-left: 30%;
       }
       .anchor {
           text-decoration: none;
       }
       #folder-div {
           margin-left: 30%;
           display: grid;
           grid-template-columns: 1fr 1fr 1fr 1fr 1fr;
       }
       #file-upload-form {
           display: flex;
           flex-basis: auto;
       }
       #create-folder-div {
           margin-left: 30%;
       }
    </style>
</head>
<body>
<div>
    <h2 align="center">Dropbox</h2>
    <div class="notification-btn">
        <span sec:authorize="isAuthenticated()">
            <a th:href="@{/logout}">
                <p th:text="'   Logout   '"></p>
            </a>
        </span>
    </div>
</div>
<div class="upload-main">
    <form th:action="@{/}" th:if="${!createFolder}">
        <input th:type="hidden" th:name="createFolder" th:value="true">
        <input id="upload-anchor" th:type="submit" th:value="Folder">
    </form>
    <form id="file-upload-form" th:action="@{/upload}" method="post" enctype="multipart/form-data">
        <input type="file" id="myFile" name="file" multiple required >
        <input style="cursor:pointer" type="submit" th:value="'Upload file'"/>
    </form>
</div>
<div id="main-div">
    <div id="button-main">
        <div class="notification-btn">
            <a class="anchor" th:href="@{/notification}">
                <p th:text="Notifications"></p>
            </a>
        </div>
        <div class="notification-btn">
            <a class="anchor" th:href="@{/shared}">
                <p th:text="Shared"></p>
            </a>
        </div>
        <div class="notification-btn">
            <a class="anchor" th:href="@{/bin}">
                <p th:text="'Deleted Files'"></p>
            </a>
        </div>
    </div>
    <br>
    <div id="create-folder-div" th:if="${createFolder}">
        <form th:object="${folder}" th:action="@{folder}" th:method="post">
            <table>
                <tr>
                    <td style="text-align: left"><p th:text="'Folder Name'"></p></td>
                </tr>
                <tr>
                    <td>
                        <input th:type="text" th:field="${folder.name}" th:size="22">
                    </td>
                </tr>
                <tr>
                    <td><input th:type="submit" th:value="Create"></td>
                </tr>
            </table>
        </form>
    </div>
    <table th:if="${!createFolder}" id="files-table">
        <tr class="files-table-row">
            <th th:text="'   '"></th>
            <th th:text="Name"></th>
            <th th:text="Download"></th>
            <th th:text="View"></th>
            <th th:text="Action"></th>
        </tr>
        <tr th:each="file : ${files}" class="files-table-row">
            <td>
                <i style="font-size:24px;color: #0e4de1" th:class="'fa fa-file'"></i>
            </td>
            <td>
                <p th:text="${file.name}"></p>
            </td>
            <td><a class="anchor" th:href="@{/download/file{id}(id = ${file.id})}" th:text="Download"></a></td>
            <td><a class="anchor" th:href="@{/view/file{id}(id = ${file.id})}" th:text="View"></a></td>
            <td>
                <div id="action-main">
                    <div id="action-div">
                        <form th:action="@{/edit}" th:if="${fileId} != ${file.id}">
                            <input th:type="hidden" th:name="fileId" th:value="${file.id}">
                            <input th:type="submit" th:value="Edit"/>
                        </form>
                        <form th:if="${edit} and ${fileId} == ${file.id}" th:action="@{/update/file{id}(id = ${file.id})}" method="post" enctype="multipart/form-data">
                            <input type="file" class="myFile" name="file" multiple required >
                            <button class="div-one" type="submit">replace file</button>
                        </form>
                        <form th:action="@{/delete/file{id}(id = ${file.id})}">
                            <input th:type="submit" th:value="Delete"/>
                        </form>
                        <form th:action="@{/share/file{id}(id = ${file.id})}">
                            <input th:type="submit" th:value="Share"/>
                        </form>
                    </div>
                </div>
            </td>
        </tr>
    </table>
    <div></div>
</div>
<div id="folder-div">
    <table th:each="userFolder : ${folders}">
        <tr class="files-table-row">
            <td>
                <i style="font-size: 50px;color: #10c3c9" th:class="'fa fa-folder'"></i>
                <a class="anchor" th:href="@{/folder/{name}(name = ${userFolder.name})}"><p th:text="${userFolder.name}"></p></a>
            </td>
        </tr>
    </table>
</div>
</body>
</html>